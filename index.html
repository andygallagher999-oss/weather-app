<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Real Weather Radar App</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css"/>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',sans-serif;background:linear-gradient(135deg,#1e3c72,#2a5298);height:100vh;overflow:hidden;}
.app-container{display:flex;flex-direction:row;height:100vh;transition:all 0.3s ease;}
.sidebar{width:320px;background:rgba(255,255,255,0.95);backdrop-filter:blur(10px);border-right:1px solid rgba(255,255,255,0.2);display:flex;flex-direction:column;box-shadow:2px 0 20px rgba(0,0,0,0.1);transition:all 0.3s ease;}
.sidebar.collapsed{width:0;opacity:0;overflow:hidden;}
.sidebar-header{padding:20px;background:linear-gradient(135deg,#667eea,#764ba2);color:white;text-align:center;display:flex;justify-content:space-between;align-items:center;}
.sidebar-header h1{font-size:20px;margin:0;font-weight:600;}
.toggle-btn{font-size:20px;cursor:pointer;background:none;border:none;color:white;}
.controls{padding:20px;flex-grow:1;overflow-y:auto;}
.control-group{margin-bottom:25px;}
.control-group label{display:block;margin-bottom:8px;font-weight:600;color:#333;font-size:14px;}
.location-input{width:100%;padding:12px 15px;border:2px solid #e1e5e9;border-radius:8px;font-size:14px;background:white;transition:all 0.3s ease;}
.location-input:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,0.1);}
.btn{width:100%;padding:12px 20px;border:none;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;text-transform:uppercase;letter-spacing:0.5px;transition:all 0.3s ease;}
.btn-primary{background:linear-gradient(135deg,#667eea,#764ba2);color:white;}
.btn-primary:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(102,126,234,0.4);}
.locations-list{background:#f8f9fa;border-radius:8px;border:1px solid #e9ecef;max-height:200px;overflow-y:auto;}
.location-item{padding:12px 15px;border-bottom:1px solid #e9ecef;cursor:pointer;display:flex;justify-content:space-between;align-items:center;transition:all 0.2s;}
.location-item:hover{background:#e9ecef;}
.location-item:last-child{border-bottom:none;}
.location-name{font-weight:600;color:#333;}
.location-weather{font-size:12px;color:#666;margin-top:2px;}
.remove-btn{color:#dc3545;font-weight:bold;cursor:pointer;padding:5px;}
.remove-btn:hover{background:rgba(220,53,69,0.1);border-radius:50%;}
.map-container{flex-grow:1;position:relative;transition:all 0.3s ease;}
#map{width:100%;height:100%;}
.legend{position:absolute;bottom:20px;left:20px;background:rgba(255,255,255,0.95);padding:15px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.2);z-index:1000;font-size:12px;}
.legend h4{margin:0 0 10px 0;color:#333;font-size:14px;}
.legend-item{display:flex;align-items:center;margin:5px 0;font-size:12px;}
.legend-color{width:20px;height:15px;margin-right:8px;border-radius:2px;}
.status-bar{position:absolute;top:20px;right:20px;background:rgba(255,255,255,0.95);padding:10px 15px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.2);z-index:1000;font-size:12px;color:#666;}
.weather-info{background:white;border-radius:8px;padding:15px;margin-top:15px;border:1px solid #e9ecef;}
.weather-info h3{color:#333;margin-bottom:10px;font-size:16px;}
.weather-detail{display:flex;justify-content:space-between;margin:8px 0;font-size:14px;}
.weather-detail strong{color:#495057;}
.error-message{background:#f8d7da;color:#721c24;padding:10px;border-radius:8px;margin:10px 0;font-size:14px;}
.loading{text-align:center;padding:20px;color:#666;}
.suggestion-item{padding:8px 10px;border-bottom:1px solid #e9ecef;cursor:pointer;background:white;}
.suggestion-item:hover{background:#e9ecef;}
.radar-controls{background:#f8f9fa;padding:15px;border-radius:8px;border:1px solid #e9ecef;}
.radar-btn{width:100%;padding:10px;margin:5px 0;border:none;border-radius:6px;cursor:pointer;font-weight:600;transition:all 0.3s ease;}
.radar-precipitation{background:#007bff;color:white;}
.radar-precipitation:hover{background:#0056b3;}
.radar-temperature{background:#fd7e14;color:white;}
.radar-temperature:hover{background:#e96002;}
.radar-clouds{background:#6f42c1;color:white;}
.radar-clouds:hover{background:#5a32a3;}
@media(max-width:768px){
    .app-container{flex-direction:column;}
    .sidebar{width:100%;height:auto;position:absolute;top:0;left:0;z-index:1001;}
    .map-container{height:100vh;}
}
</style>
</head>
<body>
<div class="app-container">
<div class="sidebar" id="sidebar">
<div class="sidebar-header">
<h1>üå¶Ô∏è Real Weather</h1>
<button class="toggle-btn" id="toggleSidebar">‚ò∞</button>
</div>
<div class="controls">
<div class="control-group">
<label>Add Location</label>
<input type="text" class="location-input" id="locationInput" placeholder="Enter city name...">
<button class="btn btn-primary" id="addLocationBtn">Add Location</button>
<div id="suggestions" style="border:1px solid #ccc;border-radius:5px;max-height:150px;overflow-y:auto;display:none;"></div>
</div>
<div class="control-group">
<label>Your Locations</label>
<div class="locations-list" id="locationsList"><div class="loading">Loading locations...</div></div>
</div>
<div class="control-group">
<label>Weather Radar Layers</label>
<div class="radar-controls">
<button class="radar-btn radar-precipitation" onclick="toggleRadarLayer('precipitation')">üåßÔ∏è Precipitation</button>
<button class="radar-btn radar-temperature" onclick="toggleRadarLayer('temperature')">üå°Ô∏è Temperature</button>
<button class="radar-btn radar-clouds" onclick="toggleRadarLayer('clouds')">‚òÅÔ∏è Clouds</button>
</div>
</div>
<div class="weather-info" id="weatherInfo"><h3>Select a location</h3><p>Click on a location to see detailed weather information</p></div>
</div>
</div>
<div class="map-container">
<div id="map"></div>
<div class="legend">
<h4>Weather Map Legend</h4>
<div class="legend-item"><div class="legend-color" style="background:#87CEEB;"></div>Clear/Light Clouds</div>
<div class="legend-item"><div class="legend-color" style="background:#4169E1;"></div>Moderate Clouds</div>
<div class="legend-item"><div class="legend-color" style="background:#0000FF;"></div>Heavy Clouds/Light Rain</div>
<div class="legend-item"><div class="legend-color" style="background:#8A2BE2;"></div>Heavy Rain</div>
</div>
<div class="status-bar" id="statusBar">Initializing weather data...</div>
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
<script>
const API_KEY='54e9fa50b7c99e471e715c740dc958af';
let map, markers={}, currentRadarLayer=null, locations={};

function updateStatusBar(msg){
    const now=new Date();
    document.getElementById('statusBar').textContent=`Last Updated: ${now.getHours()}:${now.getMinutes().toString().padStart(2,'0')} ‚Ä¢ ${msg}`;
}

async function geocodeLocation(name){
    try{
        const res=await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${encodeURIComponent(name)}&limit=5&appid=${API_KEY}`);
        return await res.json();
    }catch(e){console.error(e);return[];}
}

async function getWeatherData(lat,lon){
    try{
        const res=await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric`);
        return await res.json();
    }catch(e){console.error(e);return null;}
}

function saveLocations(){localStorage.setItem('savedLocations',JSON.stringify(Object.keys(locations)));}
function getSaved(){return JSON.parse(localStorage.getItem('savedLocations')||'[]');}

async function addLocationFromInput(inputValue){
    const name=inputValue.trim();
    if(!name) return;
    const results=await geocodeLocation(name);
    if(!results.length){alert('Location not found'); return;}
    const loc=results[0];
    const weather=await getWeatherData(loc.lat,loc.lon);
    const fullName=loc.name+(loc.country?', '+loc.country:'');
    locations[fullName]={coords:[loc.lat,loc.lon],weather};
    addMarker(fullName,loc.lat,loc.lon,weather);
    updateLocationList();
    saveLocations();
    document.getElementById('locationInput').value='';
    document.getElementById('suggestions').style.display='none';
    updateStatusBar(`Added ${fullName}`);
}

function addMarker(name,lat,lon,weather){
    if(markers[name]) map.removeLayer(markers[name]);
    const marker=L.marker([lat,lon]).addTo(map);
    marker.bindPopup(`<h3>${name}</h3><p>${weather.weather[0].description}, ${Math.round(weather.main.temp)}¬∞C</p>`);
    marker.on('click',()=>focusLocation(name));
    markers[name]=marker;
}

function updateLocationList(){
    const list=document.getElementById('locationsList'); list.innerHTML='';
    Object.keys(locations).forEach(name=>{
        const div=document.createElement('div'); div.className='location-item';
        div.innerHTML=`<div><div class="location-name">${name}</div><div class="location-weather">${locations[name].weather.weather[0].main} ‚Ä¢ ${Math.round(locations[name].weather.main.temp)}¬∞C</div></div><span class="remove-btn">&times;</span>`;
        div.onclick=()=>focusLocation(name);
        div.querySelector('.remove-btn').onclick=(e)=>{
            e.stopPropagation(); removeLocation(name);
        };
        list.appendChild(div);
    });
}

function removeLocation(name){
    if(markers[name]){map.removeLayer(markers[name]); delete markers[name];}
    delete locations[name];
    updateLocationList();
    saveLocations();
    updateStatusBar(`Removed ${name}`);
}

function focusLocation(name){
    const loc=locations[name];
    if(!loc) return;
    map.setView(loc.coords,10);
    markers[name].openPopup();
    updateWeatherInfo(name,loc.weather);
}

function updateWeatherInfo(name,weather){
    const info=document.getElementById('weatherInfo');
    info.innerHTML=`
        <h3>${name}</h3>
        <div class="weather-detail"><span>Temperature:</span><strong>${Math.round(weather.main.temp)}¬∞C (feels like ${Math.round(weather.main.feels_like)}¬∞C)</strong></div>
        <div class="weather-detail"><span>Conditions:</span><strong>${weather.weather[0].description}</strong></div>
        <div class="weather-detail"><span>Wind Speed:</span><strong>${weather.wind.speed} m/s</strong></div>
        <div class="weather-detail"><span>Humidity:</span><strong>${weather.main.humidity}%</strong></div>
        <div class="weather-detail"><span>Pressure:</span><strong>${weather.main.pressure} hPa</strong></div>
    `;
}

async function toggleRadarLayer(type){
    if(currentRadarLayer) map.removeLayer(currentRadarLayer);
    const layers={precipitation:'precipitation_new',temperature:'temp_new',clouds:'clouds_new'};
    const code=layers[type]; if(!code) return;
    currentRadarLayer=L.tileLayer(`https://tile.openweathermap.org/map/${code}/{z}/{x}/{y}.png?appid=${API_KEY}`,{opacity:0.6,attribution:'Weather ¬© OpenWeatherMap'});
    map.addLayer(currentRadarLayer);
    updateStatusBar(`${type} radar activated`);
}

function showSuggestions(results){
    const container=document.getElementById('suggestions');
    container.innerHTML='';
    if(!results || results.length===0){container.style.display='none'; return;}
    results.forEach(loc=>{
        const div=document.createElement('div'); div.className='suggestion-item';
        div.textContent=loc.name+(loc.country?', '+loc.country:'');
        div.onclick=()=>addLocationFromInput(div.textContent);
        container.appendChild(div);
    });
    container.style.display='block';
}

document.addEventListener('DOMContentLoaded',async()=>{
    map=L.map('map').setView([43.6532,-79.3832],5);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'¬© OpenStreetMap contributors'}).addTo(map);

    const saved=getSaved();
    if(saved.length===0){await addLocationFromInput('Toronto');} else {saved.forEach(addLocationFromInput);}

    const input=document.getElementById('locationInput');
    const addBtn=document.getElementById('addLocationBtn');
    addBtn.onclick=()=>addLocationFromInput(input.value);

    let timeout=null;
    input.addEventListener('input',e=>{
        clearTimeout(timeout);
        const q=e.target.value.trim();
        if(!q){showSuggestions([]); return;}
        timeout=setTimeout(async()=>{showSuggestions(await geocodeLocation(q));},300);
    });

    input.addEventListener('keypress',e=>{if(e.key==='Enter'){addLocationFromInput(input.value); showSuggestions([]);}});
    document.addEventListener('click',e=>{if(!e.target.closest('#suggestions') && e.target!==input){document.getElementById('suggestions').style.display='none';}});

    const toggleBtn=document.getElementById('toggleSidebar');
    const sidebar=document.getElementById('sidebar');
    toggleBtn.onclick=()=>{sidebar.classList.toggle('collapsed');};
});
</script>
</body>
</html>
