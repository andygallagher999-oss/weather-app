<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Real Weather Radar App</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css"/>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:linear-gradient(135deg,#1e3c72,#2a5298); height:100vh; overflow:hidden;}
.app-container{display:flex; height:100vh; flex-direction:row;}
.sidebar{width:320px; background:rgba(255,255,255,0.95); backdrop-filter:blur(10px); border-right:1px solid rgba(255,255,255,0.2); display:flex; flex-direction:column; box-shadow:2px 0 20px rgba(0,0,0,0.1);}
.sidebar-header{padding:20px; background:linear-gradient(135deg,#667eea,#764ba2); color:white; text-align:center;}
.sidebar-header h1{font-size:24px; margin-bottom:5px; font-weight:600;}
.sidebar-header p{font-size:14px; opacity:0.9;}
.controls{padding:20px; flex-grow:1; overflow-y:auto;}
.control-group{margin-bottom:25px;}
.control-group label{display:block; margin-bottom:8px; font-weight:600; color:#333; font-size:14px;}
.location-search{position:relative;}
.location-input{width:100%; padding:12px 15px; border:2px solid #e1e5e9; border-radius:8px; font-size:14px; transition: all 0.3s ease; background:white;}
.location-input:focus{outline:none; border-color:#667eea; box-shadow:0 0 0 3px rgba(102,126,234,0.1);}
#autocompleteList{display:none; position:absolute; top:100%; left:0; right:0; background:white; max-height:200px; overflow-y:auto; border:1px solid #ccc; z-index:10000; border-radius:4px;}
#autocompleteList li{padding:10px; cursor:pointer;}
#autocompleteList li:hover{background:#f1f1f1;}
.btn{width:100%; padding:12px 20px; border:none; border-radius:8px; font-size:14px; font-weight:600; cursor:pointer; transition: all 0.3s ease; text-transform:uppercase; letter-spacing:0.5px;}
.btn-primary{background:linear-gradient(135deg,#667eea,#764ba2); color:white;}
.btn-primary:hover{transform:translateY(-2px); box-shadow:0 5px 15px rgba(102,126,234,0.4);}
.locations-list{background:#f8f9fa; border-radius:8px; border:1px solid #e9ecef; max-height:200px; overflow-y:auto;}
.location-item{padding:12px 15px; border-bottom:1px solid #e9ecef; cursor:pointer; display:flex; justify-content:space-between; align-items:center;}
.location-item:hover{background:#e9ecef;}
.location-item:last-child{border-bottom:none;}
.location-name{font-weight:600; color:#333;}
.location-weather{font-size:12px; color:#666; margin-top:2px;}
.remove-btn{color:#dc3545; font-weight:bold; cursor:pointer; padding:5px;}
.remove-btn:hover{background:rgba(220,53,69,0.1); border-radius:50%;}
.map-container{flex-grow:1; position:relative;}
#map{width:100%; height:100%;}
.legend{position:absolute; bottom:20px; left:20px; background:rgba(255,255,255,0.95); padding:15px; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.2); z-index:1000;}
.legend h4{margin:0 0 10px 0; color:#333; font-size:14px;}
.legend-item{display:flex; align-items:center; margin:5px 0; font-size:12px;}
.legend-color{width:20px; height:15px; margin-right:8px; border-radius:2px;}
.status-bar{position:absolute; top:20px; right:20px; background:rgba(255,255,255,0.95); padding:10px 15px; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.2); z-index:1000; font-size:12px; color:#666;}
.weather-info{background:white; border-radius:8px; padding:15px; margin-top:15px; border:1px solid #e9ecef;}
.weather-info h3{color:#333; margin-bottom:10px; font-size:16px;}
.weather-detail{display:flex; justify-content:space-between; margin:8px 0; font-size:14px;}
.weather-detail strong{color:#495057;}
.error-message{background:#f8d7da; color:#721c24; padding:10px; border-radius:8px; margin:10px 0; font-size:14px;}
.loading{text-align:center; padding:20px; color:#666;}
.radar-controls{background:#f8f9fa; padding:15px; border-radius:8px; border:1px solid #e9ecef;}
.radar-btn{width:100%; padding:10px; margin:5px 0; border:none; border-radius:6px; cursor:pointer; font-weight:600; transition:all 0.3s ease;}
.radar-precipitation{background:#28a745;color:white;}
.radar-precipitation:hover{background:#218838;}
.radar-temperature{background:#fd7e14;color:white;}
.radar-temperature:hover{background:#e96002;}
.radar-clouds{background:#6f42c1;color:white;}
.radar-clouds:hover{background:#5a32a3;}
@media (max-width:768px){
    .app-container{flex-direction:column;}
    .sidebar{width:100%; height:50%; border-right:none; border-bottom:1px solid rgba(255,255,255,0.2);}
    .map-container{height:50%;}
}
</style>
</head>
<body>
<div class="app-container">
<div class="sidebar">
    <div class="sidebar-header">
        <h1>üå¶Ô∏è Real Weather Radar</h1>
        <p>Live Weather Data & Radar</p>
    </div>
    <div class="controls">
        <div class="control-group">
            <label>Add Location</label>
            <div class="location-search">
                <input type="text" id="locationInput" class="location-input" placeholder="Enter city name...">
                <ul id="autocompleteList"></ul>
            </div>
            <button class="btn btn-primary" id="addLocationBtn">Add Location</button>
        </div>
        <div class="control-group">
            <label>Your Locations</label>
            <div class="locations-list" id="locationsList">
                <div class="loading">Loading locations...</div>
            </div>
        </div>
        <div class="control-group">
            <label>Weather Radar Layers</label>
            <div class="radar-controls">
                <button class="radar-btn radar-precipitation" onclick="toggleRadarLayer('precipitation')">üåßÔ∏è Precipitation Radar</button>
                <button class="radar-btn radar-temperature" onclick="toggleRadarLayer('temperature')">üå°Ô∏è Temperature Map</button>
                <button class="radar-btn radar-clouds" onclick="toggleRadarLayer('clouds')">‚òÅÔ∏è Cloud Coverage</button>
            </div>
        </div>
        <div class="weather-info" id="weatherInfo">
            <h3>Select a location</h3>
            <p>Click on a location to see detailed weather information</p>
        </div>
    </div>
</div>
<div class="map-container">
    <div id="map"></div>
    <div class="legend">
        <h4>Weather Map Legend</h4>
        <div class="legend-item"><div class="legend-color" style="background:#87CEEB;"></div>Clear/Light Clouds</div>
        <div class="legend-item"><div class="legend-color" style="background:#4169E1;"></div>Moderate Clouds</div>
        <div class="legend-item"><div class="legend-color" style="background:#0000FF;"></div>Heavy Clouds/Light Rain</div>
        <div class="legend-item"><div class="legend-color" style="background:#8A2BE2;"></div>Heavy Rain</div>
    </div>
    <div class="status-bar" id="statusBar">Initializing weather data...</div>
</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
<script>
const API_CONFIG={OPENWEATHER_API_KEY:'e1b3a19a50cf215e856e091a6073636f',OPENWEATHER_BASE:'https://api.openweathermap.org/data/2.5',OPENWEATHER_TILES:'https://tile.openweathermap.org/map'};
let map,locations={},markers={},currentRadarLayer=null,searchTimeout=null;

function initializeApp(){
    map=L.map('map').setView([43.6532,-79.3832],5);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'¬© OpenStreetMap contributors'}).addTo(map);
    loadDefaultLocations();
    updateStatusBar('Weather radar app initialized');
}

async function getWeatherData(lat,lon){
    const resp=await fetch(`${API_CONFIG.OPENWEATHER_BASE}/weather?lat=${lat}&lon=${lon}&appid=${API_CONFIG.OPENWEATHER_API_KEY}&units=metric`);
    return await resp.json();
}

async function searchLocations(query){
    const list=document.getElementById('autocompleteList'); list.innerHTML='';
    if(!query){list.style.display='none'; return;}
    try{
        const resp=await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${encodeURIComponent(query)}&limit=5&appid=${API_CONFIG.OPENWEATHER_API_KEY}`);
        const results=await resp.json();
        if(!results || results.length===0){list.style.display='none'; return;}
        results.forEach(loc=>{
            const li=document.createElement('li');
            li.textContent=`${loc.name}${loc.state? ', '+loc.state:''}, ${loc.country}`;
            li.dataset.lat=loc.lat; li.dataset.lon=loc.lon;
            li.addEventListener('click',()=>{
                document.getElementById('locationInput').value=li.textContent;
                list.style.display='none';
            });
            list.appendChild(li);
        });
        list.style.display='block';
    }catch(err){console.error(err); list.style.display='none';}
}

async function addLocation(){
    const input=document.getElementById('locationInput'); const addBtn=document.getElementById('addLocationBtn');
    const value=input.value.trim(); if(!value) return;
    addBtn.disabled=true; addBtn.textContent='Adding...'; updateStatusBar('Looking up location...');
    try{
        const resp=await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${encodeURIComponent(value)}&limit=1&appid=${API_CONFIG.OPENWEATHER_API_KEY}`);
        const results=await resp.json(); if(!results || results.length===0){showError('Location not found'); return;}
        const loc=results[0]; const coords=[loc.lat,loc.lon]; const fullName=`${loc.name}${loc.state?', '+loc.state:''}, ${loc.country}`;
        const w=await getWeatherData(loc.lat,loc.lon);
        locations[fullName]={coords,weather:w}; addMarkerToMap(fullName,coords,w); addLocationToSidebar(fullName,w);
        input.value=''; updateStatusBar(`Added ${fullName}`);
    }catch(err){console.error(err); showError('Error adding location');}
    finally{addBtn.disabled=false; addBtn.textContent='Add Location';}
}

function addMarkerToMap(name,coords,weather){
    const marker=L.marker(coords).addTo(map);
    marker.bindPopup(`<div style="text-align:center;min-width:200px;"><h3>${name}</h3><div>${Math.round(weather.main.temp)}¬∞C</div><p>${weather.weather[0].description}</p></div>`);
    marker.on('click',()=>focusLocation(name)); markers[name]=marker;
}

function addLocationToSidebar(name,weather){
    const list=document.getElementById('locationsList'); const loading=list.querySelector('.loading'); if(loading) loading.remove();
    const div=document.createElement('div'); div.className='location-item'; div.onclick=()=>focusLocation(name);
    div.innerHTML=`<div><div class="location-name">${name}</div><div class="location-weather">${weather.weather[0].main} ‚Ä¢ ${Math.round(weather.main.temp)}¬∞C</div></div><span class="remove-btn" onclick="removeLocation(event,'${name}')">&times;</span>`;
    list.appendChild(div);
}

function removeLocation(event,name){event.stopPropagation(); if(markers[name]) map.removeLayer(markers[name]); delete markers[name]; delete locations[name];
document.querySelectorAll('.location-item').forEach(item=>{ if(item.querySelector('.location-name').textContent===name) item.remove(); });
updateStatusBar(`Removed ${name}`);}

function focusLocation(name){
    const loc=locations[name]; if(!loc) return; map.setView(loc.coords,10); markers[name]?.openPopup();
    const w=loc.weather; const info=document.getElementById('weatherInfo');
    info.innerHTML=`<h3>${name}</h3>
    <div class="weather-detail"><span>Temp:</span><strong>${Math.round(w.main.temp)}¬∞C</strong></div>
    <div class="weather-detail"><span>Feels Like:</span><strong>${Math.round(w.main.feels_like)}¬∞C</strong></div>
    <div class="weather-detail"><span>Conditions:</span><strong>${w.weather[0].description}</strong></div>
    <div class="weather-detail"><span>Wind:</span><strong>${w.wind.speed} m/s</strong></div>
    <div class="weather-detail"><span>Humidity:</span><strong>${w.main.humidity}%</strong></div>
    <div class="weather-detail"><span>Pressure:</span><strong>${w.main.pressure} hPa</strong></div>`;
    updateStatusBar(`Focused on ${name}`);
}

function toggleRadarLayer(type){
    if(currentRadarLayer){ map.removeLayer(currentRadarLayer); currentRadarLayer=null; }
    let url=''; if(type==='precipitation') url=`${API_CONFIG.OPENWEATHER_TILES}/precipitation_new/{z}/{x}/{y}.png?appid=${API_CONFIG.OPENWEATHER_API_KEY}`;
    else if(type==='temperature') url=`${API_CONFIG.OPENWEATHER_TILES}/temp_new/{z}/{x}/{y}.png?appid=${API_CONFIG.OPENWEATHER_API_KEY}`;
    else if(type==='clouds') url=`${API_CONFIG.OPENWEATHER_TILES}/clouds_new/{z}/{x}/{y}.png?appid=${API_CONFIG.OPENWEATHER_API_KEY}`;
    if(url){ currentRadarLayer=L.tileLayer(url,{opacity:0.5}); currentRadarLayer.addTo(map);}
    updateStatusBar(`Showing ${type} radar layer`);
}

async function loadDefaultLocations(){
    const cities=[{name:'Toronto',lat:43.6532,lon:-79.3832},{name:'Montreal',lat:45.5017,lon:-73.5673},{name:'Vancouver',lat:49.2827,lon:-123.1207}];
    for(const c of cities){
        const w=await getWeatherData(c.lat,c.lon); const name=`${c.name}, ${w.sys.country}`; locations[name]={coords:[c.lat,c.lon],weather:w};
        addMarkerToMap(name,[c.lat,c.lon],w); addLocationToSidebar(name,w);
    }
}

function updateStatusBar(msg){document.getElementById('statusBar').textContent=msg;}
function showError(msg){const controls=document.querySelector('.controls'); const e=document.createElement('div'); e.className='error-message'; e.textContent=msg; controls.insertBefore(e,controls.firstChild); setTimeout(()=>e.remove(),5000);}

// Event listeners
document.getElementById('locationInput').addEventListener('input', e=>{clearTimeout(searchTimeout); searchTimeout=setTimeout(()=>searchLocations(e.target.value),300);});
document.addEventListener('click', e=>{if(!e.target.closest('.location-search')) document.getElementById('autocompleteList').style.display='none';});
document.addEventListener('DOMContentLoaded',()=>{initializeApp();});
</script>
</body>
</html>
