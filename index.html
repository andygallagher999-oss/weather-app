<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Real Weather Radar App</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
<style>
/* ===========================
   GENERAL STYLES
=========================== */
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg,#1e3c72,#2a5298); height:100vh; }
.app-container { display:flex; flex-direction: row; height:100vh; }
.sidebar { width:320px; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); border-right:1px solid rgba(255,255,255,0.2); display:flex; flex-direction:column; box-shadow:2px 0 20px rgba(0,0,0,0.1); }
.sidebar-header { padding:20px; background:linear-gradient(135deg,#667eea,#764ba2); color:white; text-align:center; }
.sidebar-header h1 { font-size:24px; margin-bottom:5px; font-weight:600; }
.controls { padding:15px; flex-grow:1; overflow-y:auto; }
.control-group { margin-bottom:20px; }
.control-group label { display:block; margin-bottom:8px; font-weight:600; color:#333; font-size:14px; }
.location-input { width:100%; padding:10px 12px; border:2px solid #e1e5e9; border-radius:8px; font-size:14px; transition:all 0.3s ease; }
.location-input:focus { outline:none; border-color:#667eea; box-shadow:0 0 0 3px rgba(102,126,234,0.1); }
.btn { width:100%; padding:10px 15px; border:none; border-radius:8px; font-size:14px; font-weight:600; cursor:pointer; transition:all 0.3s ease; text-transform:uppercase; letter-spacing:0.5px; }
.btn-primary { background:linear-gradient(135deg,#667eea,#764ba2); color:white; }
.btn-primary:hover { transform:translateY(-2px); box-shadow:0 5px 15px rgba(102,126,234,0.4); }
.locations-list { background:#f8f9fa; border-radius:8px; border:1px solid #e9ecef; max-height:200px; overflow-y:auto; }
.location-item { padding:10px 12px; border-bottom:1px solid #e9ecef; cursor:pointer; display:flex; justify-content:space-between; align-items:center; }
.location-item:hover { background:#e9ecef; }
.location-item:last-child { border-bottom:none; }
.location-name { font-weight:600; color:#333; }
.location-weather { font-size:12px; color:#666; margin-top:2px; }
.remove-btn { color:#dc3545; font-weight:bold; cursor:pointer; padding:5px; }
.remove-btn:hover { background: rgba(220,53,69,0.1); border-radius:50%; }
.map-container { flex-grow:1; position:relative; }
#map { width:100%; height:100%; }
.legend { position:absolute; bottom:20px; left:20px; background:rgba(255,255,255,0.95); padding:10px 12px; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.2); z-index:1000; font-size:12px; }
.legend h4 { margin:0 0 5px 0; font-size:14px; color:#333; }
.legend-item { display:flex; align-items:center; margin:3px 0; font-size:12px; }
.legend-color { width:20px; height:15px; margin-right:8px; border-radius:2px; }
.status-bar { position:absolute; top:10px; right:10px; background:rgba(255,255,255,0.95); padding:8px 12px; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.2); z-index:1000; font-size:12px; color:#666; }
.weather-info { background:white; border-radius:8px; padding:10px; margin-top:15px; border:1px solid #e9ecef; font-size:14px; }
.weather-detail { display:flex; justify-content:space-between; margin:5px 0; font-size:14px; }
.weather-detail strong { color:#495057; }
.error-message { background:#f8d7da; color:#721c24; padding:10px; border-radius:8px; margin:5px 0; font-size:14px; }
.radar-controls { display:flex; flex-direction:column; }
.radar-btn { padding:8px; margin:5px 0; border:none; border-radius:6px; cursor:pointer; font-weight:600; color:white; }
.radar-precipitation { background:#0055ff; }
.radar-temperature { background:#ff5500; }
.radar-clouds { background:#5500ff; }
/* MOBILE RESPONSIVENESS */
@media(max-width:768px){
    .app-container { flex-direction:column; }
    .sidebar { width:100%; height:auto; order:2; }
    .map-container { height:400px; order:1; }
    .legend { font-size:10px; bottom:60px; left:10px; padding:8px; }
    .status-bar { font-size:10px; top:5px; right:5px; padding:6px; }
}
</style>
</head>
<body>
<div class="app-container">
    <div class="sidebar">
        <div class="sidebar-header">
            <h1>üå¶Ô∏è Real Weather Radar</h1>
        </div>
        <div class="controls">
            <div class="control-group">
                <label>Add Location</label>
                <input type="text" class="location-input" id="locationInput" placeholder="Enter city name...">
                <button class="btn btn-primary" id="addLocationBtn">Add Location</button>
                <div id="suggestions" style="position:relative;"></div>
            </div>
            <div class="control-group">
                <label>Your Locations</label>
                <div class="locations-list" id="locationsList">
                    <div class="loading">Loading locations...</div>
                </div>
            </div>
            <div class="control-group">
                <label>Weather Radar Layers</label>
                <div class="radar-controls">
                    <button class="radar-btn radar-precipitation" onclick="toggleRadarLayer('precipitation')">üåßÔ∏è Precipitation Radar</button>
                    <button class="radar-btn radar-temperature" onclick="toggleRadarLayer('temperature')">üå°Ô∏è Temperature Map</button>
                    <button class="radar-btn radar-clouds" onclick="toggleRadarLayer('clouds')">‚òÅÔ∏è Cloud Coverage</button>
                </div>
            </div>
            <div class="weather-info" id="weatherInfo">
                <h3>Select a location</h3>
                <p>Click on a location to see detailed weather information</p>
            </div>
        </div>
    </div>
    <div class="map-container">
        <div id="map"></div>
        <div class="legend">
            <h4>Legend</h4>
            <div class="legend-item"><div class="legend-color" style="background:#a3c2f7"></div>Light Clouds / Clear</div>
            <div class="legend-item"><div class="legend-color" style="background:#4169E1"></div>Moderate Clouds</div>
            <div class="legend-item"><div class="legend-color" style="background:#0000FF"></div>Heavy Clouds / Light Rain</div>
            <div class="legend-item"><div class="legend-color" style="background:#FF0000"></div>Heavy Rain</div>
        </div>
        <div class="status-bar" id="statusBar">Initializing...</div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
<script>
const API_KEY = '54e9fa50b7c99e471e715c740dc958af';
let map;
let locations = {};
let markers = {};
let currentRadarLayer = null;
let searchTimeout;

// ==========================
// Initialize Map
// ==========================
function initializeMap(){
    map = L.map('map').setView([43.6532,-79.3832],5);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'¬© OpenStreetMap contributors'}).addTo(map);
}

// ==========================
// Weather Functions
// ==========================
async function getWeatherData(lat,lon){
    try{
        const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric`);
        if(!res.ok) throw new Error(res.status);
        return await res.json();
    }catch(err){console.error(err); return null;}
}

async function geocodeLocation(query){
    try{
        const res = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${encodeURIComponent(query)}&limit=5&appid=${API_KEY}`);
        if(!res.ok) throw new Error(res.status);
        return await res.json();
    }catch(err){console.error(err); return [];}
}

// ==========================
// Add Location
// ==========================
async function addLocation(name){
    const geoResults = await geocodeLocation(name);
    if(!geoResults || geoResults.length===0){
        showError('Location not found');
        return;
    }
    const loc = geoResults[0];
    const fullName = `${loc.name}, ${loc.country}`;
    if(locations[fullName]) return; // already exists
    const weather = await getWeatherData(loc.lat,loc.lon);
    if(!weather){showError('Weather data unavailable'); return;}
    locations[fullName]={coords:[loc.lat,loc.lon],weather};
    addMarker(fullName,loc.lat,loc.lon,weather);
    addToSidebar(fullName,weather);
    saveLocations();
}

// ==========================
// Markers & Sidebar
// ==========================
function addMarker(name,lat,lon,weather){
    const marker = L.marker([lat,lon]).addTo(map);
    marker.bindPopup(`<h3>${name}</h3><p>${weather.weather[0].description}, ${Math.round(weather.main.temp)}¬∞C</p>`);
    marker.on('click',()=>updateWeatherPanel(name));
    markers[name]=marker;
}

function addToSidebar(name,weather){
    const list = document.getElementById('locationsList');
    const div = document.createElement('div');
    div.className='location-item';
    div.innerHTML=`<div><div class="location-name">${name}</div><div class="location-weather">${weather.weather[0].main} ‚Ä¢ ${Math.round(weather.main.temp)}¬∞C</div></div><span class="remove-btn">&times;</span>`;
    div.onclick=()=>updateWeatherPanel(name);
    div.querySelector('.remove-btn').onclick=(e)=>{e.stopPropagation(); removeLocation(name,div);};
    list.appendChild(div);
}

function updateWeatherPanel(name){
    const w = locations[name].weather;
    const panel = document.getElementById('weatherInfo');
    panel.innerHTML=`<h3>${name}</h3>
    <div class="weather-detail"><span>Temp:</span><strong>${Math.round(w.main.temp)}¬∞C</strong></div>
    <div class="weather-detail"><span>Feels Like:</span><strong>${Math.round(w.main.feels_like)}¬∞C</strong></div>
    <div class="weather-detail"><span>Condition:</span><strong>${w.weather[0].description}</strong></div>
    <div class="weather-detail"><span>Wind:</span><strong>${w.wind.speed} m/s</strong></div>
    <div class="weather-detail"><span>Humidity:</span><strong>${w.main.humidity}%</strong></div>`;
    map.setView(locations[name].coords,10);
    markers[name].openPopup();
}

// ==========================
// Remove Location
// ==========================
function removeLocation(name,element){
    if(markers[name]) map.removeLayer(markers[name]);
    delete locations[name];
    element.remove();
    saveLocations();
}

// ==========================
// Radar Layer
// ==========================
function toggleRadarLayer(type){
    if(currentRadarLayer) map.removeLayer(currentRadarLayer);
    const layers = {precipitation:'precipitation_new',temperature:'temp_new',clouds:'clouds_new'};
    currentRadarLayer = L.tileLayer(`https://tile.openweathermap.org/map/${layers[type]}/{z}/{x}/{y}.png?appid=${API_KEY}`,{opacity:0.6,attribution:'Weather ¬© OpenWeatherMap'});
    map.addLayer(currentRadarLayer);
}

// ==========================
// LocalStorage
// ==========================
function saveLocations(){
    localStorage.setItem('savedLocations',JSON.stringify(Object.keys(locations)));
}
async function loadLocations(){
    const saved = JSON.parse(localStorage.getItem('savedLocations')||'[]');
    for(const name of saved){ await addLocation(name);}
}

// ==========================
// Autocomplete
// ==========================
function showSuggestions(results){
    const container = document.getElementById('suggestions');
    container.innerHTML='';
    results.forEach(r=>{
        const div=document.createElement('div');
        div.className='location-item';
        div.textContent=`${r.name}, ${r.country}`;
        div.onclick=()=>{document.getElementById('locationInput').value=`${r.name}, ${r.country}`; container.innerHTML='';};
        container.appendChild(div);
    });
}

document.addEventListener('DOMContentLoaded',()=>{
    initializeMap();
    loadLocations();
    document.getElementById('addLocationBtn').onclick=()=>{
        const val = document.getElementById('locationInput').value.trim();
        if(val) addLocation(val);
    };
    const input = document.getElementById('locationInput');
    input.addEventListener('input',()=>{
        clearTimeout(searchTimeout);
        const val = input.value.trim();
        if(val==='') return document.getElementById('suggestions').innerHTML='';
        searchTimeout=setTimeout(async()=>{
            const res = await geocodeLocation(val);
            showSuggestions(res);
        },300);
    });
});

// ==========================
// Error display
// ==========================
function showError(msg){
    const controls=document.querySelector('.controls');
    const existing=controls.querySelector('.error-message');
    if(existing) existing.remove();
    const div=document.createElement('div');
    div.className='error-message';
    div.textContent=msg;
    controls.prepend(div);
    setTimeout(()=>{if(div.parentNode) div.remove();},5000);
}
</script>
</body>
</html>
