<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üå¶Ô∏è Real Weather Radar App</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
<style>
    * {margin:0;padding:0;box-sizing:border-box;}
    body {font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; height:100vh; overflow:hidden;}
    .app-container {display:flex;flex-direction:row;height:100vh;}
    .sidebar {width:320px;background:rgba(255,255,255,0.95);backdrop-filter:blur(10px);border-right:1px solid rgba(255,255,255,0.2);display:flex;flex-direction:column;box-shadow:2px 0 20px rgba(0,0,0,0.1);transition:transform 0.3s ease;}
    .sidebar.collapsed {transform:translateX(-100%);}
    .sidebar-header {padding:20px;background:linear-gradient(135deg,#667eea,#764ba2);color:white;text-align:center;}
    .sidebar-header h1 {font-size:24px;margin-bottom:5px;font-weight:600;}
    .sidebar-header p {font-size:14px;opacity:0.9;}
    .toggle-sidebar {position:absolute;top:10px;left:10px;background:#667eea;color:white;padding:10px 12px;border:none;border-radius:6px;cursor:pointer;z-index:1001;display:none;}
    .controls {padding:20px;flex-grow:1;overflow-y:auto;}
    .control-group {margin-bottom:25px;}
    .control-group label {display:block;margin-bottom:8px;font-weight:600;color:#333;font-size:14px;}
    .location-input {width:100%;padding:12px 15px;border:2px solid #e1e5e9;border-radius:8px;font-size:14px;transition:all 0.3s ease;background:white;}
    .location-input:focus {outline:none;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,0.1);}
    .btn {width:100%;padding:12px 20px;border:none;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;transition:all 0.3s ease;text-transform:uppercase;letter-spacing:0.5px;}
    .btn-primary {background:linear-gradient(135deg,#667eea,#764ba2);color:white;}
    .btn-primary:hover {transform:translateY(-2px);box-shadow:0 5px 15px rgba(102,126,234,0.4);}
    .btn-primary:disabled {opacity:0.6;cursor:not-allowed;transform:none;}
    .btn-secondary {background:#f8f9fa;color:#495057;border:2px solid #e9ecef;margin-top:10px;}
    .btn-secondary:hover {background:#e9ecef;}
    .locations-list {background:#f8f9fa;border-radius:8px;border:1px solid #e9ecef;max-height:200px;overflow-y:auto;}
    .location-item {padding:12px 15px;border-bottom:1px solid #e9ecef;cursor:pointer;transition:all 0.3s ease;display:flex;justify-content:space-between;align-items:center;}
    .location-item:hover {background:#e9ecef;}
    .location-item:last-child {border-bottom:none;}
    .location-name {font-weight:600;color:#333;}
    .location-weather {font-size:12px;color:#666;margin-top:2px;}
    .remove-btn {color:#dc3545;font-weight:bold;cursor:pointer;padding:5px;}
    .remove-btn:hover {background:rgba(220,53,69,0.1);border-radius:50%;}
    .map-container {flex-grow:1;position:relative;}
    #map {width:100%;height:100%;}
    .legend {position:absolute;bottom:20px;left:20px;background:rgba(255,255,255,0.95);padding:15px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.2);z-index:1000;font-size:12px;}
    .legend h4 {margin:0 0 10px 0;color:#333;font-size:14px;}
    .legend-item {display:flex;align-items:center;margin:5px 0;font-size:12px;}
    .legend-color {width:20px;height:15px;margin-right:8px;border-radius:2px;}
    .status-bar {position:absolute;top:20px;right:20px;background:rgba(255,255,255,0.95);padding:10px 15px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.2);z-index:1000;font-size:12px;color:#666;}
    .weather-info {background:white;border-radius:8px;padding:15px;margin-top:15px;border:1px solid #e9ecef;}
    .weather-info h3 {color:#333;margin-bottom:10px;font-size:16px;}
    .weather-detail {display:flex;justify-content:space-between;margin:8px 0;font-size:14px;}
    .weather-detail strong {color:#495057;}
    .error-message {background:#f8d7da;color:#721c24;padding:10px;border-radius:8px;margin:10px 0;font-size:14px;}
    .loading {text-align:center;padding:20px;color:#666;}
    .radar-controls {background:#f8f9fa;padding:15px;border-radius:8px;border:1px solid #e9ecef;}
    .radar-btn {width:100%;padding:10px;margin:5px 0;border:none;border-radius:6px;cursor:pointer;font-weight:600;transition:all 0.3s ease;}
    .radar-precipitation {background:#28a745;color:white;}
    .radar-precipitation:hover {background:#218838;}
    .radar-temperature {background:#fd7e14;color:white;}
    .radar-temperature:hover {background:#e96002;}
    .radar-clouds {background:#6f42c1;color:white;}
    .radar-clouds:hover {background:#5a32a3;}

    /* Mobile responsive */
    @media(max-width:768px){
        .app-container{flex-direction:column;}
        .sidebar{position:absolute;top:0;left:0;height:100vh;z-index:1000;}
        .toggle-sidebar{display:block;}
        .map-container{height:100vh;}
    }
</style>
</head>
<body>
<button class="toggle-sidebar" id="toggleSidebar">‚ò∞ Menu</button>
<div class="app-container">
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h1>üå¶Ô∏è Real Weather Radar</h1>
            <p>Live Weather Data & Radar</p>
        </div>
        <div class="controls">
            <div class="control-group">
                <label>Add Location</label>
                <input type="text" class="location-input" id="locationInput" placeholder="Enter city name...">
                <button class="btn btn-primary" id="addLocationBtn">Add Location</button>
                <div class="locations-suggestions" id="locationSuggestions" style="position:relative;"></div>
            </div>
            <div class="control-group">
                <label>Your Locations</label>
                <div class="locations-list" id="locationsList"><div class="loading">Loading locations...</div></div>
            </div>
            <div class="control-group">
                <label>Weather Radar Layers</label>
                <div class="radar-controls">
                    <button class="radar-btn radar-precipitation" onclick="toggleRadarLayer('precipitation')">üåßÔ∏è Precipitation Radar</button>
                    <button class="radar-btn radar-temperature" onclick="toggleRadarLayer('temperature')">üå°Ô∏è Temperature Map</button>
                    <button class="radar-btn radar-clouds" onclick="toggleRadarLayer('clouds')">‚òÅÔ∏è Cloud Coverage</button>
                </div>
            </div>
            <div class="weather-info" id="weatherInfo">
                <h3>Select a location</h3>
                <p>Click on a location to see detailed weather information</p>
            </div>
        </div>
    </div>
    <div class="map-container">
        <div id="map"></div>
        <div class="legend">
            <h4>Weather Map Legend</h4>
            <div class="legend-item"><div class="legend-color" style="background:#87CEEB;"></div>Clear/Light Clouds</div>
            <div class="legend-item"><div class="legend-color" style="background:#4169E1;"></div>Moderate Clouds</div>
            <div class="legend-item"><div class="legend-color" style="background:#0000FF;"></div>Heavy Clouds/Light Rain</div>
            <div class="legend-item"><div class="legend-color" style="background:#8A2BE2;"></div>Heavy Rain</div>
        </div>
        <div class="status-bar" id="statusBar">Initializing weather data...</div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
<script>
const API_CONFIG = {
    OPENWEATHER_API_KEY: 'e1b3a19a50cf215e856e091a6073636f',
    RAINVIEWER_API:'https://api.rainviewer.com/public/weather-maps.json',
    OPENWEATHER_BASE:'https://api.openweathermap.org/data/2.5',
    OPENWEATHER_TILES:'https://tile.openweathermap.org/map'
};

let map, locations = {}, markers = {}, currentRadarLayer=null, radarData=null, searchTimeout=null;

// Initialize map
function initializeApp(){
    map = L.map('map').setView([43.6532,-79.3832],5);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png',{
        attribution:'&copy; OpenStreetMap &copy; CARTO'
    }).addTo(map);
    loadDefaultLocations();
    updateStatusBar('Weather radar app initialized');
}

// Status bar
function updateStatusBar(message){
    const statusBar = document.getElementById('statusBar');
    const now = new Date();
    const timeString = `${now.getHours()}:${now.getMinutes().toString().padStart(2,'0')}`;
    statusBar.textContent = `Last Updated: ${timeString} ‚Ä¢ ${message}`;
}

// Error message
function showError(message){
    const controls = document.querySelector('.controls');
    const existingError = controls.querySelector('.error-message');
    if(existingError) existingError.remove();
    const errorDiv = document.createElement('div');
    errorDiv.className='error-message';
    errorDiv.textContent=message;
    controls.insertBefore(errorDiv,controls.firstChild);
    setTimeout(()=>{if(errorDiv.parentNode) errorDiv.remove();},5000);
}

// Get weather data
async function getWeatherData(lat,lon){
    try{
        const response = await fetch(`${API_CONFIG.OPENWEATHER_BASE}/weather?lat=${lat}&lon=${lon}&appid=${API_CONFIG.OPENWEATHER_API_KEY}&units=metric`);
        if(!response.ok) throw new Error('Weather API error');
        return await response.json();
    }catch(e){console.error(e); showError('Error loading weather data'); return null;}
}

// Geocode location for autocomplete/add
async function geocodeLocation(locationName){
    try{
        const response = await fetch(`${API_CONFIG.OPENWEATHER_BASE}/geo/1.0/direct?q=${encodeURIComponent(locationName)}&limit=5&appid=${API_CONFIG.OPENWEATHER_API_KEY}`);
        if(!response.ok) throw new Error('Geocoding API error');
        return await response.json();
    }catch(e){console.error(e); return null;}
}

// Add marker
function addMarkerToMap(name,coords,weatherData){
    const marker = L.marker(coords).addTo(map);
    const popupContent = `<div style="text-align:center;min-width:200px;"><h3>${name}</h3><div style="font-size:24px;font-weight:bold;">${Math.round(weatherData.main.temp)}¬∞C</div><p>${weatherData.weather[0].description}</p><div style="display:flex;justify-content:space-between;font-size:12px;"><span>üí® ${weatherData.wind.speed} m/s</span><span>üíß ${weatherData.main.humidity}%</span></div></div>`;
    marker.bindPopup(popupContent);
    markers[name]=marker;
    marker.on('click',()=>focusLocation(name));
}

// Add location to sidebar
function addLocationToSidebar(name,weatherData){
    const listContainer=document.getElementById('locationsList');
    const loading=listContainer.querySelector('.loading');
    if(loading) loading.remove();
    const locationDiv=document.createElement('div');
    locationDiv.className='location-item';
    locationDiv.onclick=()=>focusLocation(name);
    const temp=Math.round(weatherData.main.temp);
    const description=weatherData.weather[0].main;
    locationDiv.innerHTML=`<div><div class="location-name">${name}</div><div class="location-weather">${description} ‚Ä¢ ${temp}¬∞C</div></div><span class="remove-btn" onclick="event.stopPropagation(); removeLocation('${name}',this)">&times;</span>`;
    listContainer.appendChild(locationDiv);
}

// Focus location
function focusLocation(name){
    if(locations[name]){
        const coords=locations[name].coords;
        const weather=locations[name].weather;
        map.setView(coords,10);
        if(markers[name]) markers[name].openPopup();
        updateWeatherInfo(name,weather);
        updateStatusBar(`Focused on ${name}`);
    }
}

// Update weather info panel
function updateWeatherInfo(name,weather){
    const weatherInfo=document.getElementById('weatherInfo');
    const temp=Math.round(weather.main.temp);
    const feelsLike=Math.round(weather.main.feels_like);
    weatherInfo.innerHTML=`<h3>${name}</h3>
    <div class="weather-detail"><span>Temperature:</span><strong>${temp}¬∞C (feels like ${feelsLike}¬∞C)</strong></div>
    <div class="weather-detail"><span>Conditions:</span><strong>${weather.weather[0].description}</strong></div>
    <div class="weather-detail"><span>Wind Speed:</span><strong>${weather.wind.speed} m/s</strong></div>
    <div class="weather-detail"><span>Humidity:</span><strong>${weather.main.humidity}%</strong></div>
    <div class="weather-detail"><span>Pressure:</span><strong>${weather.main.pressure} hPa</strong></div>`;
}

// Remove location permanently
function removeLocation(name,element){
    if(markers[name]) {map.removeLayer(markers[name]); delete markers[name];}
    delete locations[name];
    element.parentElement.remove();
    localStorage.setItem('savedLocations',JSON.stringify(locations));
    updateStatusBar(`Removed ${name}`);
}

// Add location
async function addLocation(name){
    const input=document.getElementById('locationInput');
    const addBtn=document.getElementById('addLocationBtn');
    const locationName=name||input.value.trim();
    if(!locationName) return;
    addBtn.disabled=true; addBtn.textContent='Adding...'; updateStatusBar('Looking up location...');
    try{
        const geoResults=await geocodeLocation(locationName);
        if(!geoResults||geoResults.length===0){showError('Location not found'); return;}
        const location=geoResults[0];
        const coords=[location.lat,location.lon];
        const fullName=`${location.name}, ${location.country||''}`;
        const weatherData=await getWeatherData(location.lat,location.lon);
        if(weatherData){
            locations[fullName]={coords,weather:weatherData};
            addMarkerToMap(fullName,coords,weatherData);
            addLocationToSidebar(fullName,weatherData);
            input.value='';
            localStorage.setItem('savedLocations',JSON.stringify(locations));
            updateStatusBar(`Added ${fullName}`);
        }else showError('Could not get weather data');
    }catch(e){console.error(e);showError('Error adding location');}
    finally{addBtn.disabled=false; addBtn.textContent='Add Location';}
}

// Load default or saved locations
async function loadDefaultLocations(){
    const saved=localStorage.getItem('savedLocations');
    const listContainer=document.getElementById('locationsList');
    listContainer.innerHTML='<div class="loading">Loading locations...</div>';
    const defaultCities=[
        {name:'Toronto',coords:[43.6532,-79.3832]},
        {name:'New York',coords:[40.7128,-74.006]},
        {name:'London',coords:[51.5074,-0.1278]}
    ];
    const cities=saved?Object.entries(JSON.parse(saved)).map(([name,data])=>({name,data})):defaultCities;
    for(const city of cities){
        try{
            let fullName,tempCoords,tempWeather;
            if(saved){fullName=city.name;tempCoords=city.data.coords;tempWeather=city.data.weather;}
            else{fullName=`${city.name}, Unknown`;tempCoords=city.coords; tempWeather=await getWeatherData(city.coords[0],city.coords[1]);}
            if(tempWeather){locations[fullName]={coords:tempCoords,weather:tempWeather}; addMarkerToMap(fullName,tempCoords,tempWeather); addLocationToSidebar(fullName,tempWeather);}
        }catch(e){console.error(e);}
    }
    const loading=listContainer.querySelector('.loading'); if(loading) loading.remove();
}

// Toggle radar layer with enhanced colors
function toggleRadarLayer(type){
    if(currentRadarLayer) map.removeLayer(currentRadarLayer);
    const layerMap={
        'precipitation':{code:'precipitation_new',filter:'contrast(150%) saturate(250%) hue-rotate(200deg) brightness(1.2)'},
        'temperature':{code:'temp_new',filter:'contrast(150%) saturate(180%) hue-rotate(15deg) brightness(1.2)'},
        'clouds':{code:'clouds_new',filter:'contrast(200%) saturate(200%) hue-rotate(200deg) brightness(1.2)'}
    };
    const selected=layerMap[type];
    if(selected){
        const url=`${API_CONFIG.OPENWEATHER_TILES}/${selected.code}/{z}/{x}/{y}.png?appid=${API_CONFIG.OPENWEATHER_API_KEY}`;
        currentRadarLayer=L.tileLayer(url,{opacity:0.6}).addTo(map);
    }
    updateStatusBar(`Radar: ${type}`);
}

// Autocomplete
const locationInput=document.getElementById('locationInput');
const suggestionsDiv=document.getElementById('locationSuggestions');
locationInput.addEventListener('input',()=>{
    clearTimeout(searchTimeout);
    const query=locationInput.value.trim();
    if(!query){suggestionsDiv.innerHTML=''; return;}
    searchTimeout=setTimeout(async()=>{
        const results=await geocodeLocation(query);
        if(!results||results.length===0){suggestionsDiv.innerHTML=''; return;}
        suggestionsDiv.innerHTML='';
        results.forEach(loc=>{
            const div=document.createElement('div');
            div.style.padding='10px'; div.style.cursor='pointer'; div.style.borderBottom='1px solid #e9ecef';
            div.textContent=`${loc.name}, ${loc.country||''}`;
            div.onclick=()=>{addLocation(`${loc.name}, ${loc.country||''}`); suggestionsDiv.innerHTML='';};
            suggestionsDiv.appendChild(div);
        });
    },300);
});

// Toggle sidebar (mobile)
document.getElementById('toggleSidebar').addEventListener('click',()=>{
    const sidebar=document.getElementById('sidebar');
    sidebar.classList.toggle('collapsed');
});

// Add location button
document.getElementById('addLocationBtn').addEventListener('click',()=>addLocation());

// Initialize app
initializeApp();
</script>
</body>
</html>
